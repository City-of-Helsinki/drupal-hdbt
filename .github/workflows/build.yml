on:
  pull_request:
    types: [opened, synchronize]
name: Build assets
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 1

      - name: Set variables
        run: echo "NODE_VERSION=$(cat .nvmrc)" >> $GITHUB_ENV

      - name: Clone platform
        run: git clone https://github.com/City-of-Helsinki/drupal-helfi-platform.git $DRUPAL_ROOT

      - name: Build assets
        run: docker run --rm -v $(pwd):/app -w /app node:${NODE_VERSION}-alpine ""npm install && npm run build""

      - name: Commit changed assets
        run: |
          git config --global user.name github-actions
          git config --global user.email github-actions@github.com
          git add dist
          git commit -m "CI build"
          git push



