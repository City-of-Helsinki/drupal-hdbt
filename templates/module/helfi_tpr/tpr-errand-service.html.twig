{#
/**
 * @file
 * Template for a TPR Service Channel entity.
 */
#}

{%
  set classes = [
  'errand-service',
  view_mode ? 'errand-service--' ~ view_mode|clean_class,
]
%}

<article{{ attributes.addClass(classes) }}>

  <div class="errand-service__container container">

    {# Sote uses simple mode, for the rest this is enabled by default (check sote tpr-errand-service.html.twig) #}
    {% if not errand_service_simple_mode %}

      <div{{ content_attributes.addClass('errand-service__header') }}>
        <h2{{ title_attributes.addClass('errand-service__title') }}>
          {{ content.name }}
        </h2>
      </div>

      {% if content.description|render %}
        <div class="errand-service__description">
          {{ content.description }}
        </div>
      {% endif %}

      {% if
        content.process_description|render or
        content.processing_time|render or
        content.expiration_time|render or
        content.costs|render or
        content.information|render
      %}

        {% block paragraph %}
          {% embed "@hdbt/misc/component.twig" with
            {
              component_classes: [
                'component--accordion',
                'component--accordion-bg-grey',
                'component--hardcoded',
                'errand-service__accordion',
              ],
              component_content_class: ['accordion', 'user-edited-content'],
            }
          %}
            {% block component_content %}

              {% if
                content.process_description|render or
                content.processing_time|render or
                content.expiration_time|render
              %}

                {% include '@hdbt/component/accordion.twig' with {
                  heading_level: 'h3',
                  heading: 'Process'|t({}, {'context': 'Errand service accordion heading'}),
                  content: errand_service_process,
                } %}

              {% endif %}
              {% if content.costs|render %}

                {% include '@hdbt/component/accordion.twig' with {
                  heading_level: 'h3',
                  heading: 'Fees'|t({}, {'context': 'Errand service accordion heading'}),
                  content: errand_service_fees,
                } %}

              {% endif %}
              {% if content.information|render %}

                {% include '@hdbt/component/accordion.twig' with {
                  heading_level: 'h3',
                  heading: 'Additional information and links'|t({}, {'context': 'Errand service accordion heading'}),
                  content: errand_service_additional_info,
                } %}

              {% endif %}

            {% endblock component_content %}
          {% endembed %}
        {% endblock paragraph %}

      {% endif %}
    {% endif %}

    {% if content.channels|render %}
      <div class="errand-service__channels">

        {% for channels in errand_service_channels %}

          {% set service_channel_type_class = 'service-channel--' ~ channels.type|lower %}

          {% set service_channel_heading_level = service_channel_heading_level|default('h3') %}

          {% if service_channel_heading_level is same as('h2') %}
            {% set channel_title_level = 'h3' %}
          {% elseif service_channel_heading_level is same as('h4') %}
            {% set channel_title_level = 'h5' %}
          {% elseif service_channel_heading_level is same as('h5') %}
            {% set channel_title_level = 'h6' %}
          {% else %}
            {% set channel_title_level = 'h4' %}
          {% endif %}

          {% set service_channel_links_new_tab = service_channel_links_new_tab|default(0) %}

          <article class="service-channel {{ service_channel_type_class }}">
            <{{ service_channel_heading_level }} class="service-channel__type">
              {{ channels.type_verb }}
            </{{ service_channel_heading_level }}>
            {% for channel in channels.content %}
              {% include "@hdbt/module/helfi_tpr/tpr-service-channel.html.twig" with {channel: channel, channel_type: channels.type, channel_title_level: channel_title_level} %}
            {% endfor %}
          </article>
        {% endfor %}

      </div>
    {% endif %}

  </div>

</article>
