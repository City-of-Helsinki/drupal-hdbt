"use strict";(()=>{var W=Object.create;var j=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var K=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var G=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of V(e))!J.call(n,s)&&s!==t&&j(n,s,{get:()=>e[s],enumerable:!(r=$(e,s))||r.enumerable});return n};var Q=(n,e,t)=>(t=n!=null?W(z(n)):{},G(e||!n||!n.__esModule?j(t,"default",{value:n,enumerable:!0}):t,n));var q=K((Ie,S)=>{(function(){"use strict";var n={}.hasOwnProperty;function e(){for(var t=[],r=0;r<arguments.length;r++){var s=arguments[r];if(s){var a=typeof s;if(a==="string"||a==="number")t.push(s);else if(Array.isArray(s)){if(s.length){var i=e.apply(null,s);i&&t.push(i)}}else if(a==="object")if(s.toString===Object.prototype.toString)for(var o in s)n.call(s,o)&&s[o]&&t.push(o);else t.push(s.toString())}}return t.join(" ")}typeof S<"u"&&S.exports?(e.default=e,S.exports=e):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return e}):window.classNames=e})()});var X=Object.prototype.toString,x=Array.isArray||function(e){return X.call(e)==="[object Array]"};function C(n){return typeof n=="function"}function Y(n){return x(n)?"array":typeof n}function A(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function U(n,e){return n!=null&&typeof n=="object"&&e in n}function Z(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var ee=RegExp.prototype.test;function te(n,e){return ee.call(n,e)}var ne=/\S/;function re(n){return!te(ne,n)}var se={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ae(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return se[t]})}var ie=/\s*/,oe=/\s+/,M=/\s*=/,le=/\s*\}/,ue=/#|\^|\/|>|\{|&|=|!/;function ce(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],i=!1,o=!1,l="",u=0;function h(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var v,_,O;function T(g){if(typeof g=="string"&&(g=g.split(oe,2)),!x(g)||g.length!==2)throw new Error("Invalid tags: "+g);v=new RegExp(A(g[0])+"\\s*"),_=new RegExp("\\s*"+A(g[1])),O=new RegExp("\\s*"+A("}"+g[1]))}T(e||m.tags);for(var c=new L(n),b,f,d,k,E,y;!c.eos();){if(b=c.pos,d=c.scanUntil(v),d)for(var R=0,H=d.length;R<H;++R)k=d.charAt(R),re(k)?(a.push(s.length),l+=k):(o=!0,t=!0,l+=" "),s.push(["text",k,b,b+1]),b+=1,k===`
`&&(h(),l="",u=0,t=!1);if(!c.scan(v))break;if(i=!0,f=c.scan(ue)||"name",c.scan(ie),f==="="?(d=c.scanUntil(M),c.scan(M),c.scanUntil(_)):f==="{"?(d=c.scanUntil(O),c.scan(le),c.scanUntil(_),f="&"):d=c.scanUntil(_),!c.scan(_))throw new Error("Unclosed tag at "+c.pos);if(f==">"?E=[f,d,b,c.pos,l,u,t]:E=[f,d,b,c.pos],u++,s.push(E),f==="#"||f==="^")r.push(E);else if(f==="/"){if(y=r.pop(),!y)throw new Error('Unopened section "'+d+'" at '+b);if(y[1]!==d)throw new Error('Unclosed section "'+y[1]+'" at '+b)}else f==="name"||f==="{"||f==="&"?o=!0:f==="="&&T(d)}if(h(),y=r.pop(),y)throw new Error('Unclosed section "'+y[1]+'" at '+c.pos);return pe(he(s))}function he(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function pe(n){for(var e=[],t=e,r=[],s,a,i=0,o=n.length;i<o;++i)switch(s=n[i],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function L(n){this.string=n,this.tail=n,this.pos=0}L.prototype.eos=function(){return this.tail===""};L.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};L.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function w(n,e){this.view=n,this.cache={".":this.view},this.parent=e}w.prototype.push=function(e){return new w(e,this)};w.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,i,o,l=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(l=U(a,i[o])||Z(a,i[o])),a=a[i[o++]];else a=s.view[e],l=U(s.view,e);if(l){r=a;break}s=s.parent}t[e]=r}return C(r)&&(r=r.call(this.view)),r};function p(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}p.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};p.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||m.tags).join(":"),a=typeof r<"u",i=a?r.get(s):void 0;return i==null&&(i=ce(e,t),a&&r.set(s,i)),i};p.prototype.render=function(e,t,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=t instanceof w?t:new w(t,void 0);return this.renderTokens(i,o,r,e,s)};p.prototype.renderTokens=function(e,t,r,s,a){for(var i="",o,l,u,h=0,v=e.length;h<v;++h)u=void 0,o=e[h],l=o[0],l==="#"?u=this.renderSection(o,t,r,s,a):l==="^"?u=this.renderInverted(o,t,r,s,a):l===">"?u=this.renderPartial(o,t,r,a):l==="&"?u=this.unescapedValue(o,t):l==="name"?u=this.escapedValue(o,t,a):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(i+=u);return i};p.prototype.renderSection=function(e,t,r,s,a){var i=this,o="",l=t.lookup(e[1]);function u(_){return i.render(_,t,r,a)}if(l){if(x(l))for(var h=0,v=l.length;h<v;++h)o+=this.renderTokens(e[4],t.push(l[h]),r,s,a);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],t.push(l),r,s,a);else if(C(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(t.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],t,r,s,a);return o}};p.prototype.renderInverted=function(e,t,r,s,a){var i=t.lookup(e[1]);if(!i||x(i)&&i.length===0)return this.renderTokens(e[4],t,r,s,a)};p.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};p.prototype.renderPartial=function(e,t,r,s){if(r){var a=this.getConfigTags(s),i=C(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],l=e[5],u=e[4],h=i;l==0&&u&&(h=this.indentPartial(i,u,o));var v=this.parse(h,a);return this.renderTokens(v,t,r,h,s)}}};p.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};p.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||m.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===m.escape?String(a):s(a)};p.prototype.rawValue=function(e){return e[1]};p.prototype.getConfigTags=function(e){return x(e)?e:e&&typeof e=="object"?e.tags:void 0};p.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!x(e))return e.escape};var m={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){I.templateCache=n},get templateCache(){return I.templateCache}},I=new p;m.clearCache=function(){return I.clearCache()};m.parse=function(e,t){return I.parse(e,t)};m.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Y(e)+'" was given as the first argument for mustache#render(template, view, partials)');return I.render(e,t,r,s)};m.escape=ae;m.Scanner=L;m.Context=w;m.Writer=p;var B=m;var F=Q(q()),D=Drupal.t("Frontpage",{},{context:"Global navigation mobile menu top level"}),fe=Drupal.t("Open submenu:",{},{context:"Mobile navigation menu prefix"}),de=Drupal.t("Open parent menu:",{},{context:"Mobile navigation menu prefix"});Array.prototype.findRecursive=function(e,t){if(!t)throw new Error("findRecursive requires parameter `childrenPropertyName`");let r=[];r=this;let s=r.find(e),a=r.filter(i=>i[t]);if(s)return s;if(a.length){let i=[];return a.forEach(o=>{i.push(...o[t])}),i.findRecursive(e,t)}};function me(){return this.sub_tree?.length>0}function N(){let n;try{n=new URL(this.url).pathname}catch{n=this.url}return!this.external&&this.url&&n===window.location.pathname}function ve(){return!!this.active}function ge(){return!!this.inPath}function be(){return!!this.is_injected}function _e(){return{external:this.attributes["data-external"]||this.external||!1,protocol:this.attributes["data-protocol"]||!1}}function ye(){return!!this.attributes?.lang}function P(){return this.external?P.ICONS[this.attributes["data-protocol"]]||P.ICONS.external:!1}P.ICONS={mailto:{class:"link__type link__type--mailto",text:Drupal.t("Link opens default mail program",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link opens default mail program."})},tel:{class:"link__type link__type--tel",text:Drupal.t("Link starts a phone call",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link starts a phone call."})},external:{class:"link__type link__type--external",text:Drupal.t("Link leads to external service",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link leads to an external service."})}};var we={compileTemplates(){this.templates={panel:`
  {{#panels}}
    <section class="{{panel_class}}">
      <div class="mmenu__panel-body">
        {{#back}}
          <button class="mmenu__back">
            <span class="visually-hidden">{{openParentMenuTranslation}}</span>
            <span class="mmenu__back-wrapper">{{back}}</span>
          </button>
        {{/back}}
        <a href="{{url}}" class="mmenu__title-link{{#isInPath}} mmenu__title-link--in-path{{/isInPath}}"{{#isActive}} aria-current="page"{{/isActive}}

        {{#externalLinkAttributes.external}}
          data-external="true"
        {{/externalLinkAttributes.external}}

        {{#externalLinkAttributes.protocol}}
          data-protocol="{{externalLinkAttributes.protocol}}"
        {{/externalLinkAttributes.protocol}}

        ><span class="mmenu__link__text"

        {{#hasLang}}
          lang="{{attributes.lang}}"
        {{/hasLang}}

        >{{name}}</span>{{#externalLinkIcon}} <span class="{{class}}"></span><span class="visually-hidden">({{ text }})</span>{{/externalLinkIcon}}</a>
        {{>sub_tree}}
      </div>
      ${document.querySelector(".js-mmenu__footer")?.outerHTML}
    </section>
  {{/panels}}

  {{^panels}}
  <div class="mmenu__loading">
    <div class="hds-loading-spinner">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  {{/panels}}
  `,list:`
    <ul class="mmenu__items">
      {{#sub_tree}}
        <li class="mmenu__item">
          <a href="{{url}}" class="mmenu__item-link{{#isInPath}} mmenu__item-link--in-path{{/isInPath}}{{#isInjected}} mmenu__item-link--injected{{/isInjected}}"{{#isActive}} aria-current="page"{{/isActive}}
          {{#externalLinkAttributes.external}}
            data-external="true"
          {{/externalLinkAttributes.external}}
          {{#externalLinkAttributes.protocol}}
            data-protocol={{externalLinkAttributes.protocol}}
          {{/externalLinkAttributes.protocol}}

          ><span class="mmenu__link__text"

          {{#hasLang}}
            lang="{{attributes.lang}}"
          {{/hasLang}}

            >{{name}}</span>{{#externalLinkIcon}} <span class="{{class}}"></span><span class="visually-hidden">({{ text }})</span>{{/externalLinkIcon}}
          </a>
          {{#button}}
            <button class="mmenu__forward " value={{id}}><span class="visually-hidden">{{openSubMenuTranslation}} {{name}}</span></button>
          {{/button}}
        </li>
      {{/sub_tree}}
    </ul>
   `}},menu:null,templates:null,SCROLL_TRESHOLD:100,size:10,running:!1,data:null,currentIndex:0,cacheKey:"hdbt-mobile-menu",enableCache:!1,selectors:{container:"#mmenu",rootId:"mmenu__panels",forward:"mmenu__forward",back:"mmenu__back"},getAPIUrl(){let n=new URL(drupalSettings?.helfi_navigation?.links?.api);return n.searchParams.set("_format","json"),n.searchParams.set("max-depth",drupalSettings?.menu_depth),n.toString()},getRoot(){return document.getElementById(this.selectors.rootId)},sortPanelsByPath(){let n=[],e=this.data,t=e.findRecursive(s=>N.call(s),"sub_tree"),r=t?.sub_tree?.length?t.id:t?.parentId;for(;r;)e.findRecursive(({id:a,url:i,name:o,sub_tree:l,parentId:u,inPath:h,active:v})=>a===r?(n.push({sub_tree:l,name:o,url:i,parentId:u,inPath:h,active:v}),r=u,!0):!1,"sub_tree")||(r=void 0);n.push({sub_tree:e,inPath:!0}),n.reverse(),this.currentIndex=n.length-1,this.content=[...n]},content:[],getView(n){return this.content.map((e,t)=>({...e,name:e?.name||D,url:e.url||drupalSettings.helfi_navigation.links.canonical,button:me,isActive:ve,isInPath:ge,isInjected:be,externalLinkAttributes:_e,hasLang:ye,externalLinkIcon:P,back:t>0?this.content.at(t-1)?.name??D:!1,openSubMenuTranslation:fe,openParentMenuTranslation:de,panel_class:(0,F.default)({mmenu__panel:!0,"mmenu__panel--visible":!0,"mmenu__panel--current":t===this.currentIndex,"mmenu__panel--visible-right":n==="start"&&t>this.currentIndex||n==="up"&&t>=this.currentIndex||n==="down"&&t>this.currentIndex+1,"mmenu__panel--visible-left":n==="up"&&t<this.currentIndex-1||n==="down"&&t<=this.currentIndex})}))},up(n){if(!n)throw new Error(`Id missing for next menu item  ${n}`);let e=this.content.at(this.currentIndex).sub_tree.find(({id:t})=>t===n);if(!e)throw new Error(`ID mismatch in menu items${n}`);this.currentIndex=this.currentIndex+1<this.size?this.currentIndex+1:this.currentIndex,this.content[this.currentIndex]=e,this.render("up")},down(){this.currentIndex!==0&&(this.currentIndex=this.currentIndex-1>=0?this.currentIndex-1:this.currentIndex,this.render("down"))},render(n){let e=this.getRoot();if(e.innerHTML=B.render(this.templates.panel,{panels:this.getView(n)},{sub_tree:this.templates.list}),n==="load")return;let t=[...e.querySelectorAll(".mmenu__panel")],r=t.at(this.currentIndex);e.parentElement.scrollTop>this.SCROLL_TRESHOLD&&this.currentIndex>0&&r.querySelector(".mmenu__back").scrollIntoView({block:"start",behaviour:"smooth"}),setTimeout(()=>{switch(r.classList.remove("mmenu__panel--visible-right","mmenu__panel--visible-left"),n){case"up":t.at(this.currentIndex-1).classList.add("mmenu__panel--visible-left");break;case"down":t.at(this.currentIndex+1).classList.add("mmenu__panel--visible-right");break;default:}setTimeout(()=>{t.forEach(s=>{s.classList.contains("mmenu__panel--current")||(s.style.visibility="hidden")})},200)},10)},async load(){let e=await(await fetch(this.getAPIUrl())).json(),t=Object.getOwnPropertyNames(e);if(!t.length)throw new Error("No instances found in data",e);let r=t.map(i=>{let o=e[i].menu_tree[0];return o.parentId="",o}),s=r.findRecursive(i=>N.call(i),"sub_tree");s&&(s.active=!0,s.inPath=!0);let a=s?.parentId;for(;a;)r.findRecursive(o=>o.id===a?(a=o.parentId,o.inPath=!0,!0):!1,"sub_tree")||(a=void 0);this.data=r},async start(){let n=document.querySelector(this.selectors.container);if(!this.getRoot()||!n)throw new Error("Panel root not found");n.classList.add("mmenu--visible"),this.render("load");try{await this.load()}catch(e){console.error("Unable to load menu API, using fallback menu instead",e),this.enableFallback();return}this.sortPanelsByPath(),this.render("start"),this.getRoot().addEventListener("click",e=>{let{target:{classList:t,value:r,parentElement:s}}=e;e.stopImmediatePropagation(),t&&t.contains(this.selectors.forward)?this.up(r):(t&&t.contains(this.selectors.back)||s?.classList&&s?.classList.contains(this.selectors.back))&&this.down()})},isOpen(){return window.location.hash==="#menu"||this.toggleButton.getAttribute("aria-expanded")==="true"},disableFallback(){this.menu.dataset.js=!0},enableFallback(){this.menu.dataset.target="false",this.getRoot().innerHTML="",delete this.menu.dataset.js,window.location.hash="#menu"},close(){this.toggleButton.setAttribute("aria-expanded","false"),this.menu.dataset.target="false",this.onClose&&this.onClose()},open(){this.menu.dataset.target="true",this.toggleButton.setAttribute("aria-expanded","true"),this.onOpen&&this.onOpen()},toggle(){this.isOpen()?this.close():this.open(),this.toggleButton.focus()},init({onOpen:n,onClose:e}){if(this.running){console.warn("MobilePanel already initiated. Is it include more than once?");return}if(this.onOpen=n,this.onClose=e,this.toggleButton=document.querySelector(".js-menu-toggle-button"),!this.toggleButton)throw new Error("No toggle button for JS menu.");if(this.menu=document.querySelector("#menu"),!this.menu){console.error("Panel not present in DOM. Cannot start JS mobile menu");return}this.disableFallback(),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.isOpen()&&(this.close(),this.toggleButton.focus())});let t=()=>{this.compileTemplates(),this.toggleButton.removeEventListener("click",t),this.start()};this.toggleButton.addEventListener("click",t),this.toggleButton.addEventListener("click",()=>this.toggle()),this.isOpen()&&(window.location.hash="",t(),this.open()),this.running=!0}},Ee=we;})();
