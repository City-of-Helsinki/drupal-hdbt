(()=>{var $=Object.create;var C=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var i=(n,e)=>C(n,"name",{value:e,configurable:!0});var G=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Q=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of z(e))!K.call(n,s)&&s!==t&&C(n,s,{get:()=>e[s],enumerable:!(r=V(e,s))||r.enumerable});return n};var X=(n,e,t)=>(t=n!=null?$(J(n)):{},Q(e||!n||!n.__esModule?C(t,"default",{value:n,enumerable:!0}):t,n));var D=G((Ee,P)=>{(function(){var n={}.hasOwnProperty;function e(){for(var t=[],r=0;r<arguments.length;r++){var s=arguments[r];if(s){var a=typeof s;if(a==="string"||a==="number")t.push(s);else if(Array.isArray(s)){if(s.length){var o=e.apply(null,s);o&&t.push(o)}}else if(a==="object")if(s.toString===Object.prototype.toString)for(var l in s)n.call(s,l)&&s[l]&&t.push(l);else t.push(s.toString())}}return t.join(" ")}i(e,"classNames"),typeof P<"u"&&P.exports?(e.default=e,P.exports=e):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return e}):window.classNames=e})()});var Y=Object.prototype.toString,k=Array.isArray||i(function(e){return Y.call(e)==="[object Array]"},"isArrayPolyfill");function T(n){return typeof n=="function"}i(T,"isFunction");function Z(n){return k(n)?"array":typeof n}i(Z,"typeStr");function O(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}i(O,"escapeRegExp");function M(n,e){return n!=null&&typeof n=="object"&&e in n}i(M,"hasProperty");function ee(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}i(ee,"primitiveHasOwnProperty");var te=RegExp.prototype.test;function ne(n,e){return te.call(n,e)}i(ne,"testRegExp");var re=/\S/;function se(n){return!ne(re,n)}i(se,"isWhitespace");var ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ie(n){return String(n).replace(/[&<>"'`=\/]/g,i(function(t){return ae[t]},"fromEntityMap"))}i(ie,"escapeHtml");var oe=/\s*/,le=/\s+/,B=/\s*=/,ue=/\s*\}/,ce=/#|\^|\/|>|\{|&|=|!/;function he(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],o=!1,l=!1,u="",c=0;function p(){if(o&&!l)for(;a.length;)delete s[a.pop()];else a=[];o=!1,l=!1}i(p,"stripSpace");var g,y,j;function U(b){if(typeof b=="string"&&(b=b.split(le,2)),!k(b)||b.length!==2)throw new Error("Invalid tags: "+b);g=new RegExp(O(b[0])+"\\s*"),y=new RegExp("\\s*"+O(b[1])),j=new RegExp("\\s*"+O("}"+b[1]))}i(U,"compileTags"),U(e||v.tags);for(var h=new E(n),_,d,m,I,S,w;!h.eos();){if(_=h.pos,m=h.scanUntil(g),m)for(var A=0,W=m.length;A<W;++A)I=m.charAt(A),se(I)?(a.push(s.length),u+=I):(l=!0,t=!0,u+=" "),s.push(["text",I,_,_+1]),_+=1,I===`
`&&(p(),u="",c=0,t=!1);if(!h.scan(g))break;if(o=!0,d=h.scan(ce)||"name",h.scan(oe),d==="="?(m=h.scanUntil(B),h.scan(B),h.scanUntil(y)):d==="{"?(m=h.scanUntil(j),h.scan(ue),h.scanUntil(y),d="&"):m=h.scanUntil(y),!h.scan(y))throw new Error("Unclosed tag at "+h.pos);if(d==">"?S=[d,m,_,h.pos,u,c,t]:S=[d,m,_,h.pos],c++,s.push(S),d==="#"||d==="^")r.push(S);else if(d==="/"){if(w=r.pop(),!w)throw new Error('Unopened section "'+m+'" at '+_);if(w[1]!==m)throw new Error('Unclosed section "'+w[1]+'" at '+_)}else d==="name"||d==="{"||d==="&"?l=!0:d==="="&&U(m)}if(p(),w=r.pop(),w)throw new Error('Unclosed section "'+w[1]+'" at '+h.pos);return fe(pe(s))}i(he,"parseTemplate");function pe(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}i(pe,"squashTokens");function fe(n){for(var e=[],t=e,r=[],s,a,o=0,l=n.length;o<l;++o)switch(s=n[o],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}i(fe,"nestTokens");function E(n){this.string=n,this.tail=n,this.pos=0}i(E,"Scanner");E.prototype.eos=i(function(){return this.tail===""},"eos");E.prototype.scan=i(function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},"scan");E.prototype.scanUntil=i(function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r},"scanUntil");function x(n,e){this.view=n,this.cache={".":this.view},this.parent=e}i(x,"Context");x.prototype.push=i(function(e){return new x(e,this)},"push");x.prototype.lookup=i(function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,o,l,u=!1;s;){if(e.indexOf(".")>0)for(a=s.view,o=e.split("."),l=0;a!=null&&l<o.length;)l===o.length-1&&(u=M(a,o[l])||ee(a,o[l])),a=a[o[l++]];else a=s.view[e],u=M(s.view,e);if(u){r=a;break}s=s.parent}t[e]=r}return T(r)&&(r=r.call(this.view)),r},"lookup");function f(){this.templateCache={_cache:{},set:i(function(e,t){this._cache[e]=t},"set"),get:i(function(e){return this._cache[e]},"get"),clear:i(function(){this._cache={}},"clear")}}i(f,"Writer");f.prototype.clearCache=i(function(){typeof this.templateCache<"u"&&this.templateCache.clear()},"clearCache");f.prototype.parse=i(function(e,t){var r=this.templateCache,s=e+":"+(t||v.tags).join(":"),a=typeof r<"u",o=a?r.get(s):void 0;return o==null&&(o=he(e,t),a&&r.set(s,o)),o},"parse");f.prototype.render=i(function(e,t,r,s){var a=this.getConfigTags(s),o=this.parse(e,a),l=t instanceof x?t:new x(t,void 0);return this.renderTokens(o,l,r,e,s)},"render");f.prototype.renderTokens=i(function(e,t,r,s,a){for(var o="",l,u,c,p=0,g=e.length;p<g;++p)c=void 0,l=e[p],u=l[0],u==="#"?c=this.renderSection(l,t,r,s,a):u==="^"?c=this.renderInverted(l,t,r,s,a):u===">"?c=this.renderPartial(l,t,r,a):u==="&"?c=this.unescapedValue(l,t):u==="name"?c=this.escapedValue(l,t,a):u==="text"&&(c=this.rawValue(l)),c!==void 0&&(o+=c);return o},"renderTokens");f.prototype.renderSection=i(function(e,t,r,s,a){var o=this,l="",u=t.lookup(e[1]);function c(y){return o.render(y,t,r,a)}if(i(c,"subRender"),!!u){if(k(u))for(var p=0,g=u.length;p<g;++p)l+=this.renderTokens(e[4],t.push(u[p]),r,s,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")l+=this.renderTokens(e[4],t.push(u),r,s,a);else if(T(u)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,s.slice(e[3],e[5]),c),u!=null&&(l+=u)}else l+=this.renderTokens(e[4],t,r,s,a);return l}},"renderSection");f.prototype.renderInverted=i(function(e,t,r,s,a){var o=t.lookup(e[1]);if(!o||k(o)&&o.length===0)return this.renderTokens(e[4],t,r,s,a)},"renderInverted");f.prototype.indentPartial=i(function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),o=0;o<a.length;o++)a[o].length&&(o>0||!r)&&(a[o]=s+a[o]);return a.join(`
`)},"indentPartial");f.prototype.renderPartial=i(function(e,t,r,s){if(r){var a=this.getConfigTags(s),o=T(r)?r(e[1]):r[e[1]];if(o!=null){var l=e[6],u=e[5],c=e[4],p=o;u==0&&c&&(p=this.indentPartial(o,c,l));var g=this.parse(p,a);return this.renderTokens(g,t,r,p,s)}}},"renderPartial");f.prototype.unescapedValue=i(function(e,t){var r=t.lookup(e[1]);if(r!=null)return r},"unescapedValue");f.prototype.escapedValue=i(function(e,t,r){var s=this.getConfigEscape(r)||v.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===v.escape?String(a):s(a)},"escapedValue");f.prototype.rawValue=i(function(e){return e[1]},"rawValue");f.prototype.getConfigTags=i(function(e){return k(e)?e:e&&typeof e=="object"?e.tags:void 0},"getConfigTags");f.prototype.getConfigEscape=i(function(e){if(e&&typeof e=="object"&&!k(e))return e.escape},"getConfigEscape");var v={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){L.templateCache=n},get templateCache(){return L.templateCache}},L=new f;v.clearCache=i(function(){return L.clearCache()},"clearCache");v.parse=i(function(e,t){return L.parse(e,t)},"parse");v.render=i(function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Z(e)+'" was given as the first argument for mustache#render(template, view, partials)');return L.render(e,t,r,s)},"render");v.escape=ie;v.Scanner=E;v.Context=x;v.Writer=f;var q=v;var H=X(D());var N=Drupal.t("Frontpage",{},{context:"Global navigation mobile menu top level"}),de=Drupal.t("Open submenu:",{},{context:"Mobile navigation menu prefix"}),me=Drupal.t("Open parent menu:",{},{context:"Mobile navigation menu prefix"});Array.prototype.findRecursive=i(function(e,t){if(!t)throw new Error("findRecursive requires parameter `childrenPropertyName`");let r=[];r=this;let s=r.find(e),a=r.filter(o=>o[t]);if(s)return s;if(a.length){let o=[];return a.forEach(l=>{o.push(...l[t])}),o.findRecursive(e,t)}},"findRecursivelyFromArray");function ve(){return this.sub_tree?.length>0}i(ve,"button");function F(){let n;try{n=new URL(this.url).pathname}catch{n=this.url}return!this.external&&this.url&&n===window.location.pathname}i(F,"isCurrentPath");function ge(){return!!this.active}i(ge,"isActive");function be(){return!!this.inPath}i(be,"isInPath");function _e(){return!!this.is_injected}i(_e,"isInjected");function ye(){return{external:this.attributes["data-external"]||this.external||!1,protocol:this.attributes["data-protocol"]||!1}}i(ye,"externalLinkAttributes");function we(){return!!this.attributes?.lang}i(we,"hasLang");function R(){return this.external?R.ICONS[this.attributes["data-protocol"]]||R.ICONS.external:!1}i(R,"externalLinkIcon");R.ICONS={mailto:{class:"link__type link__type--mailto",text:Drupal.t("Link opens default mail program",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link opens default mail program."})},tel:{class:"link__type link__type--tel",text:Drupal.t("Link starts a phone call",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link starts a phone call."})},external:{class:"link__type link__type--external",text:Drupal.t("Link leads to external service",{},{context:"Explanation for screen-reader software that the icon visible next to this link means that the link leads to an external service."})}};var xe={compileTemplates(){this.templates={panel:`
  {{#panels}}
    <section class="{{panel_class}}">
      <div class="mmenu__panel-body">
        {{#back}}
          <button class="mmenu__back">
            <span class="visually-hidden">{{openParentMenuTranslation}}</span>
            <span class="mmenu__back-wrapper">{{back}}</span>
          </button>
        {{/back}}
        <a href="{{url}}" class="mmenu__title-link{{#isInPath}} mmenu__title-link--in-path{{/isInPath}}"{{#isActive}} aria-current="page"{{/isActive}}

        {{#externalLinkAttributes.external}}
          data-external="true"
        {{/externalLinkAttributes.external}}

        {{#externalLinkAttributes.protocol}}
          data-protocol="{{externalLinkAttributes.protocol}}"
        {{/externalLinkAttributes.protocol}}

        ><span class="mmenu__link__text"

        {{#hasLang}}
          lang="{{attributes.lang}}"
        {{/hasLang}}

        >{{name}}</span>{{#externalLinkIcon}} <span class="{{class}}"></span><span class="visually-hidden">({{ text }})</span>{{/externalLinkIcon}}</a>
        {{>sub_tree}}
      </div>
      ${document.querySelector(".js-mmenu__footer")?.outerHTML}
    </section>
  {{/panels}}

  {{^panels}}
  <div class="mmenu__loading">
    <div class="hds-loading-spinner">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  {{/panels}}
  `,list:`
    <ul class="mmenu__items">
      {{#sub_tree}}
        <li class="mmenu__item">
          <a href="{{url}}" class="mmenu__item-link{{#isInPath}} mmenu__item-link--in-path{{/isInPath}}{{#isInjected}} mmenu__item-link--injected{{/isInjected}}"{{#isActive}} aria-current="page"{{/isActive}}
          {{#externalLinkAttributes.external}}
            data-external="true"
          {{/externalLinkAttributes.external}}
          {{#externalLinkAttributes.protocol}}
            data-protocol={{externalLinkAttributes.protocol}}
          {{/externalLinkAttributes.protocol}}

          ><span class="mmenu__link__text"

          {{#hasLang}}
            lang="{{attributes.lang}}"
          {{/hasLang}}

            >{{name}}</span>{{#externalLinkIcon}} <span class="{{class}}"></span><span class="visually-hidden">({{ text }})</span>{{/externalLinkIcon}}
          </a>
          {{#button}}
            <button class="mmenu__forward " value={{id}}><span class="visually-hidden">{{openSubMenuTranslation}} {{name}}</span></button>
          {{/button}}
        </li>
      {{/sub_tree}}
    </ul>
   `}},menu:null,templates:null,SCROLL_TRESHOLD:100,size:10,running:!1,data:null,currentIndex:0,cacheKey:"hdbt-mobile-menu",enableCache:!1,selectors:{container:"#mmenu",rootId:"mmenu__panels",forward:"mmenu__forward",back:"mmenu__back"},getAPIUrl(){let n=new URL(drupalSettings?.helfi_navigation?.links?.api);return n.searchParams.set("_format","json"),n.searchParams.set("max-depth",drupalSettings?.menu_depth),n.toString()},getRoot(){return document.getElementById(this.selectors.rootId)},sortPanelsByPath(){let n=[],e=this.data,t=e.findRecursive(s=>F.call(s),"sub_tree"),r=t?.sub_tree?.length?t.id:t?.parentId;for(;r;)e.findRecursive(({id:a,url:o,name:l,sub_tree:u,parentId:c,inPath:p,active:g})=>a===r?(n.push({sub_tree:u,name:l,url:o,parentId:c,inPath:p,active:g}),r=c,!0):!1,"sub_tree")||(r=void 0);n.push({sub_tree:e,inPath:!0}),n.reverse(),this.currentIndex=n.length-1,this.content=[...n]},content:[],getView(n){return this.content.map((e,t)=>({...e,name:e?.name||N,url:e.url||drupalSettings.helfi_navigation.links.canonical,button:ve,isActive:ge,isInPath:be,isInjected:_e,externalLinkAttributes:ye,hasLang:we,externalLinkIcon:R,back:t>0?this.content.at(t-1)?.name??N:!1,openSubMenuTranslation:de,openParentMenuTranslation:me,panel_class:(0,H.default)({mmenu__panel:!0,"mmenu__panel--visible":!0,"mmenu__panel--current":t===this.currentIndex,"mmenu__panel--visible-right":n==="start"&&t>this.currentIndex||n==="up"&&t>=this.currentIndex||n==="down"&&t>this.currentIndex+1,"mmenu__panel--visible-left":n==="up"&&t<this.currentIndex-1||n==="down"&&t<=this.currentIndex})}))},up(n){if(!n)throw new Error(`Id missing for next menu item  ${n}`);let e=this.content.at(this.currentIndex).sub_tree.find(({id:t})=>t===n);if(!e)throw new Error(`ID mismatch in menu items${n}`);this.currentIndex=this.currentIndex+1<this.size?this.currentIndex+1:this.currentIndex,this.content[this.currentIndex]=e,this.render("up")},down(){this.currentIndex!==0&&(this.currentIndex=this.currentIndex-1>=0?this.currentIndex-1:this.currentIndex,this.render("down"))},render(n){let e=this.getRoot();if(e.innerHTML=q.render(this.templates.panel,{panels:this.getView(n)},{sub_tree:this.templates.list}),n==="load")return;let t=[...e.querySelectorAll(".mmenu__panel")],r=t.at(this.currentIndex);e.parentElement.scrollTop>this.SCROLL_TRESHOLD&&this.currentIndex>0&&r.querySelector(".mmenu__back").scrollIntoView({block:"start",behaviour:"smooth"}),setTimeout(()=>{switch(r.classList.remove("mmenu__panel--visible-right","mmenu__panel--visible-left"),n){case"up":t.at(this.currentIndex-1).classList.add("mmenu__panel--visible-left");break;case"down":t.at(this.currentIndex+1).classList.add("mmenu__panel--visible-right");break;default:}setTimeout(()=>{t.forEach(s=>{s.classList.contains("mmenu__panel--current")||(s.style.visibility="hidden")})},200)},10)},async load(){let e=await(await fetch(this.getAPIUrl())).json(),t=Object.getOwnPropertyNames(e);if(!t.length)throw new Error("No instances found in data",e);let r=t.map(o=>{let l=e[o].menu_tree[0];return l.parentId="",l}),s=r.findRecursive(o=>F.call(o),"sub_tree");s&&(s.active=!0,s.inPath=!0);let a=s?.parentId;for(;a;)r.findRecursive(l=>l.id===a?(a=l.parentId,l.inPath=!0,!0):!1,"sub_tree")||(a=void 0);this.data=r},async start(){let n=document.querySelector(this.selectors.container);if(!this.getRoot()||!n)throw new Error("Panel root not found");n.classList.add("mmenu--visible"),this.render("load");try{await this.load()}catch(e){console.error("Unable to load menu API, using fallback menu instead",e),this.enableFallback();return}this.sortPanelsByPath(),this.render("start"),this.getRoot().addEventListener("click",e=>{let{target:{classList:t,value:r,parentElement:s}}=e;e.stopImmediatePropagation(),t&&t.contains(this.selectors.forward)?this.up(r):(t&&t.contains(this.selectors.back)||s?.classList&&s?.classList.contains(this.selectors.back))&&this.down()})},isOpen(){return window.location.hash==="#menu"||this.toggleButton.getAttribute("aria-expanded")==="true"},disableFallback(){this.menu.dataset.js=!0},enableFallback(){this.menu.dataset.target="false",this.getRoot().innerHTML="",delete this.menu.dataset.js,window.location.hash="#menu"},close(){this.toggleButton.setAttribute("aria-expanded","false"),this.menu.dataset.target="false",this.onClose&&this.onClose()},open(){this.menu.dataset.target="true",this.toggleButton.setAttribute("aria-expanded","true"),this.onOpen&&this.onOpen()},toggle(){this.isOpen()?this.close():this.open(),this.toggleButton.focus()},init({onOpen:n,onClose:e}){if(this.running){console.warn("MobilePanel already initiated. Is it include more than once?");return}if(this.onOpen=n,this.onClose=e,this.toggleButton=document.querySelector(".js-menu-toggle-button"),!this.toggleButton)throw new Error("No toggle button for JS menu.");if(this.menu=document.querySelector("#menu"),!this.menu){console.error("Panel not present in DOM. Cannot start JS mobile menu");return}this.disableFallback(),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.isOpen()&&(this.close(),this.toggleButton.focus())});let t=i(()=>{this.compileTemplates(),this.toggleButton.removeEventListener("click",t),this.start()},"start");this.toggleButton.addEventListener("click",t),this.toggleButton.addEventListener("click",()=>this.toggle()),this.isOpen()&&(window.location.hash="",t(),this.open()),this.running=!0}},Re=xe;})();
